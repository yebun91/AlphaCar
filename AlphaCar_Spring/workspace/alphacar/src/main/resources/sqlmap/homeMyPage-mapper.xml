<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="homeMyPage.mapper">
	<!--웹 회원 정보 수정 -->
	<update id="memberUpdate">
		update customer set customer_pw = #{customer_pw}, 
			customer_name = #{customer_name}, 
			admin = #{admin},
			customer_picture = #{customer_picture},
			city = #{city},
			addr = #{addr}
		where customer_email = #{customer_email}
	</update>
	
	<!-- 내회사 리스트 뽑아오기 -->
	<select id="company_select" resultType="homeMypage.HomeCompanyVO">
		select * 
		from store s, store_file f
		where s.customer_email = #{customer_email} 
			and s.store_number = f.store_number
	</select>
	
	<!-- 내 회사 지우기 -->
	<delete id="company_delete">
		delete from store
		where store_number = #{store_number}	
	</delete>
	
	
	
	<!-- 회원정보 select -->
	<select id="customerList" resultType="member.WebMemberVO">
		select *
		from (select rownum no, w.* 
				from ( select * 
					   from customer
					   <include refid="where_search" />
					   order by customer_name) w
			  order by no desc)
		where no between #{beginList} and #{endList}
	</select>
	
	<sql id = 'where_search'>
		<if test='search == "M"'>
			where admin = 'M' 
		</if>
		<if test='search == "C"'>
			where admin = 'C' 
		</if>
 		<if test='search == "all"'>
   			<if test="keyword != null">
   				where customer_email like '%'||#{keyword}||'%' or customer_name like '%'||#{keyword}||'%'
   			</if>
		</if>
		<if test='search == "customer_name"'>
   			<if test="keyword != null">
   				where customer_name like '%'||#{keyword}||'%'
   			</if>
		</if>
		<if test='search == "customer_email"'>
			<if test="keyword != null">
   				where customer_email like '%'||#{keyword}||'%'
   			</if>
		</if> -->
	</sql>
	
	
	<!-- <sql id = 'where_search'>
		<if test="search == 'M' ">
			where admin = 'M' 
			<if test="keyword != null">
   				and customer_email like '%'||#{keyword}||'%'
   			</if>
		</if>
		<if test="search == 'C' ">
			where admin = 'C' 
			<if test="keyword != null">
   				and customer_email like '%'||#{keyword}||'%'
   			</if>
		</if>
		<if test="search == 'all' ">
   			<if test="keyword != null">
   				where customer_email like '%'||#{keyword}||'%'
   			</if>
		</if>
	</sql> -->
	
	<!-- 전체 공지글 수 조회 -->
	<select id="customerTotalList" resultType="integer">
		select count(*) from customer <include refid="where_search" />
	</select>
</mapper>