<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="homeBestQna.mapper">

	<!-- 공지사항 신규 글 등록 -->
	<insert id="homeInsert">
		insert into web_best_qna (best_qna_id, customer_email, best_qna_title,
			best_qna_content, best_qna_filename, best_qna_filepath, best_qna_attribute)
		values ( seq_web_best_qna.nextval, #{customer_email}, #{best_qna_title}, #{best_qna_content}
			, #{best_qna_filename, jdbcType=VARCHAR }, #{best_qna_filepath, jdbcType=VARCHAR }, #{best_qna_attribute})
	</insert>
	
	
	<!-- 글 목록 조회 -->	
	<select id="homeBestQnaList" resultType="homeBestQna.BestQnaVO">
		select w.*,  c.customer_name customer_name
		from web_best_qna w, customer c
		where w.customer_email = c.customer_email
		order by w.best_qna_id desc
	</select>
	
		<sql id = 'where_search'>
		<if test="search == 'notice' ">
			where NOTICE_ATTRIBUTE = 'N' 
			<if test="keyword != null">
   				and notice_title like '%'||#{keyword}||'%'
   		</if>
		</if>
		<if test="search == 'alphacer' ">
			where NOTICE_ATTRIBUTE = 'A' 
			<if test="keyword != null">
   				and notice_title like '%'||#{keyword}||'%'
   			</if>
		</if>
	
		<if test="search == 'maintainance' ">
			where NOTICE_ATTRIBUTE = 'M' 
			<if test="keyword != null">
   				and notice_title like '%'||#{keyword}||'%'
   			</if>
		</if>
		<if test="search == 'all' ">
			
   			<if test="keyword != null">
   				where notice_title like '%'||#{keyword}||'%'
   			</if>
		</if>
	</sql>
	
	<!-- 글 자세히보기 -->
	<select id="homeBestQnaDetail" resultType="homeBestQna.BestQnaVO">
		select * 
		from (select w.*, c.customer_name 
			  from web_best_qna w, customer c
			  where w.customer_email = c.customer_email)
		where best_qna_id = #{id}
	</select>
	
	<!-- 조회수 증가 -->
	<update id="homeBestQnaRead">
		update web_best_qna
		set best_qna_readcnt = best_qna_readcnt +1
		where best_qna_id = #{id}	
	</update>
		
	
	<!-- 전체 공지글 수 조회 -->
	
	<select id="hometotalList" resultType="integer">
		select count(*) from web_best_qna <include refid="where_search" />
	</select>
</mapper>